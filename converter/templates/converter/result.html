{% extends "converter/base.html" %}

{% load static %}

{% block title %}Download Ready - HimigTube{% endblock %}

{% block content %}

<!-- ğŸ‰ Main Conversion Container -->
<div class="result-container animate-fade">
  <h2>ğŸµ Na-convert na: {{ title }}</h2>

  {% if thumbnail %}
    <img src="{{ thumbnail }}" alt="Thumbnail" class="result-thumb" />
  {% endif %}

  <!-- ğŸ§¼ Cat Laundry Meme (will be hidden after processing) -->
  <div class="meme-container" id="memeContainer">
    <div class="tenor-gif-embed" data-postid="6062928582326868864" data-share-method="host" data-aspect-ratio="0.919679" data-width="100%">
      <a href="https://tenor.com/view/cat-catlaun-wash-washed-laundry-gif-6062928582326868864">Cat Catlaun GIF</a>
      from <a href="https://tenor.com/search/cat-gifs">Cat GIFs</a>
    </div>
    <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
  </div>

  <!-- ğŸ“Š Loading Progress Section -->
  <div class="loading-section">
    <p class="loading-message">â³ Sandali lang haâ€¦ kinoconvert pa.</p>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- âœ… Download MP3 Area (includes HimigTube branding now) -->
  <div class="download-area hidden" id="downloadArea">
    <!-- ğŸŒ… HimigTube Logo + Text inside card -->
    <div class="result-header">
      <img src="{% static 'converter/logo/logo.png' %}" alt="HimigTube Logo" class="result-logo">
      <h1 class="result-title">HimigTube</h1>
      <p class="result-subtitle">Pinoy YouTube to MP3 Converter ğŸ‡µğŸ‡­</p>
    </div>

    <p class="success-text">âœ… Handa na ang iyong MP3!</p>
    <a href="{{ download_url }}" class="download-btn" download>
      â¬‡ï¸ I-download ang MP3
    </a>
    <div class="back-home">
      <a href="{% url 'converter:home' %}" class="home-link">â¬…ï¸ Bumalik sa Home</a>
    </div>
  </div>

  <!-- ğŸ” Hugot Lines + Progress Simulation Script -->
  <script>
    let progress = 0;
    const fill = document.getElementById("progressFill");
    const area = document.getElementById("downloadArea");
    const commentText = document.querySelector(".loading-message");
    const meme = document.getElementById("memeContainer");

    const hugotLines = [
    "ğŸ’¬ Iniintindi ka pa rin niya kahit hindi mo na siya kinakausap...",
    "ğŸ”§ Hinahanap ang tamang bitrateâ€¦ parang hanap mo sa taong totoo sa'yo.",
    "ğŸ¶ Naghihintay ng pag-ibig... este, ng MP3 mo.",
    "ğŸŒ€ Sinasala ang ingay â€” tulad ng mga red flag sa relasyon.",
    "â³ Parang love life mo, medyo matagalâ€¦ pero darating din.",
    "ğŸ§ Tinitimpla ang quality â€” para hindi ka na mag-settle sa less than 320kbps.",
    "ğŸ“€ Niluluto paâ€¦ parang adobo ng feelings.",
    "ğŸ”„ Reprocessing... kasi minsan kailangan mo rin ng second chance.",
    "ğŸ’” Nag-buffer ka rin ba nung iniwan ka niya?",
    "ğŸšï¸ I-adjust natinâ€¦ baka masyadong mahina ang pagmamahal.",
    "ğŸ“¼ Minsan, kailangan mo lang i-rewind para ma-realize ang lahat.",
    "ğŸ”Š Hindi lahat ng malakas, totoo. Minsan, maingay lang.",
    "ğŸ“» Si Lizza daw mahilig sa OPM... pero ikaw, baka 'di niya pinapakinggan.",
    "ğŸ’¿ Gusto mo siyang i-play ulit, pero may takot kang baka ma-skip ka na naman.",
    "ğŸ’Œ Hindi lahat ng draft nai-send. Minsan, tulad ng feelings mo kay Lizza.",
    "ğŸ§ƒ Chill ka langâ€¦ parang si Lizza minsan, tahimik pero mabigat sa damdamin.",
    "ğŸ§© Kung siya ang missing piece mo, baka siya rin ang ayaw nang ma-restore.",
    "ğŸ“± Kahit i-convert mo lahat ng songs, 'di pa rin siya babalik.",
    "ğŸï¸ Replay ka nang replayâ€¦ pero 'yung memories lang talaga ang bumabalik.",
    "â˜ï¸ MP3 na ngaâ€¦ pero 'yung closure, naka-cloud pa rin."
  ];


    // ğŸ’¬ Change hugot line every 2.5s
    let commentIndex = 0;
    const commentChanger = setInterval(() => {
      commentText.textContent = hugotLines[commentIndex % hugotLines.length];
      commentIndex++;
    }, 2500);

    // ğŸ“Š Simulate slow loading progress
    const simulateProgress = setInterval(() => {
      progress += Math.random() * 20;
      fill.style.width = Math.min(progress, 100) + "%";

      if (progress >= 100) {
        clearInterval(simulateProgress);
        clearInterval(commentChanger);
        document.querySelector(".loading-section").style.display = "none";
        area.classList.remove("hidden");
        if (meme) meme.style.display = "none"; // Hide meme when done

        // â¬‡ï¸ Auto-download
        setTimeout(() => {
          const dlBtn = document.querySelector(".download-btn");
          if (dlBtn) dlBtn.click();
        }, 1000);
      }
    }, 400);
  </script>
</div>

{% endblock %}
